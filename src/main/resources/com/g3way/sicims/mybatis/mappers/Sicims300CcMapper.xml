<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.g3way.sicims.mybatis.mappers.Sicims300CcMapper">

	<!--
	================================
	  1.1 민원관리-건설업등록기준사전조사 자료관리
	================================
	 -->
	<!--  건설업등록기준사전조사정보 -->
	<resultMap id="ccCsmaResultMap" type="com.g3way.sicims.services.sicims300Cc.vo.CcCsmaVo" >
		<result column="cirs_sn"					property="cirsSn"				jdbcType="DECIMAL"/>
		<result column="reg_inst_cd"				property="regInstCd"			jdbcType="VARCHAR"/>
		<result column="pbanc_no"					property="pbancNo"				jdbcType="VARCHAR"/>
		<result column="pbanc_ymd"					property="pbancYmd"				jdbcType="VARCHAR"/>
		<result column="opnbd_ymd"					property="opnbdYmd"				jdbcType="VARCHAR"/>
		<result column="cstrn_nm"					property="cstrnNm"				jdbcType="VARCHAR"/>
		<result column="cstrn_amt"					property="cstrnAmt"				jdbcType="DECIMAL"/>
		<result column="podr_inst_nm"				property="podrInstNm"			jdbcType="VARCHAR"/>
		<result column="bid_prtcpt_cndtn"			property="bidPrtcptCndtn" 		jdbcType="VARCHAR"/>
		<result column="bid_prtcpt_bzenty_cnt"		property="bidPrtcptBzentyCnt" 	jdbcType="DECIMAL"/>
		<result column="qfexmn_1rnk_bzenty_nm"		property="qfexmn1rnkBzentyNm" 	jdbcType="VARCHAR"/>
		<result column="exmn_bzenty_se"				property="exmnBzentySe" 		jdbcType="VARCHAR"/>
		<result column="exmn_bzenty_se_nm"			property="exmnBzentySeNm" 		jdbcType="VARCHAR"/>
		<result column="exmn_bzenty_nm"				property="exmnBzentyNm" 		jdbcType="VARCHAR"/>
		<result column="exmn_bzenty_rprsv_nm"		property="exmnBzentyRprsvNm" 	jdbcType="VARCHAR"/>
		<result column="spco_se"					property="spcoSe" 				jdbcType="VARCHAR"/>
		<result column="exmn_bzenty_addr"			property="exmnBzentyAddr" 		jdbcType="VARCHAR"/>
		<result column="exmn_bzenty_pic_nm"			property="exmnBzentyPicNm" 		jdbcType="VARCHAR"/>
		<result column="exmn_bzenty_pic_telno"		property="exmnBzentyPicTelno" 	jdbcType="VARCHAR"/>
		<result column="exmn_bzenty_pic_eml_addr"	property="exmnBzentyPicEmlAddr" jdbcType="VARCHAR"/>
		<result column="exmn_bzenty_pic_pswd"		property="exmnBzentyPicPswd" 	jdbcType="VARCHAR"/>
		<result column="exmn_bzenty_crno"			property="exmnBzentyCrno" 		jdbcType="VARCHAR"/>
		<result column="mfld_cd"					property="mfldCd"				jdbcType="VARCHAR"/>
		<result column="pssn_lcns"					property="pssnLcns"				jdbcType="VARCHAR"/>
		<result column="mmadvn_se"					property="mmadvnSe"				jdbcType="VARCHAR"/>
		<result column="task_tkcg_ao_nm"			property="taskTkcgAoNm"			jdbcType="VARCHAR"/>
		<result column="cptl_tkcg_ao_nm"			property="cptlTkcgAoNm"			jdbcType="VARCHAR"/>
		<result column="acse_cstrn_pic_nm"			property="acseCstrnPicNm"		jdbcType="VARCHAR"/>
		<result column="sbmsn_bgng_ymd"				property="sbmsnBgngYmd"			jdbcType="VARCHAR"/>
		<result column="sbmsn_end_ymd"				property="sbmsnEndYmd"			jdbcType="VARCHAR"/>
		<result column="sbmsn_stts_cd"				property="sbmsnSttsCd"			jdbcType="VARCHAR"/>
		<result column="sbmsn_ymd"					property="sbmsnYmd"				jdbcType="VARCHAR"/>

		<result column="use_yn"						property="useYn"				jdbcType="VARCHAR"/>
		<result column="updt_ymd"					property="updtYmd"				jdbcType="VARCHAR"/>
		<result column="updusr_id"					property="updusrId"				jdbcType="VARCHAR"/>
		<result column="updusr_ip"					property="updusrIp"				jdbcType="VARCHAR"/>
		<result column="rmrk"						property="rmrk"					jdbcType="VARCHAR"/>

		<result column="reg_inst_nm"				property="regInstNm"			jdbcType="VARCHAR"/>
		<result column="mfld_nm"					property="mfldNm"				jdbcType="VARCHAR"/>
		<result column="mmadvn_se_nm"				property="mmadvnSeNm"			jdbcType="VARCHAR"/>
		<result column="sbmsn_stts_nm"				property="sbmsnSttsNm"			jdbcType="VARCHAR"/>

		<result column="seq_no"						property="seqNo"				jdbcType="DECIMAL" />
		<result column="page"						property="page"					jdbcType="DECIMAL" />
		<result column="total_count"				property="totalCount"			jdbcType="DECIMAL" />
	</resultMap>

	<!-- 페이지 단위로 건설업등록기준사전조사 목록을 조회한다.  -->
	<select id="selectCcCsmaList" parameterType="hashmap" resultMap="ccCsmaResultMap">
		SELECT
				  cirs_sn								/* 건설업등록기준일련번호 */
				, reg_inst_cd							/* 등록기관코드		*/
				, pbanc_ymd								/* 공고일자			*/
				, opnbd_ymd								/* 개찰일자			*/
				, mfld_cd								/* 주력분야코드		*/
				, cstrn_nm								/* 공사명			*/
				, podr_inst_nm							/* 발주기관명		*/
				, cstrn_amt/100000000	AS cstrn_amt	/* 공사금액(억원)	*/
				, exmn_bzenty_se						/* 조사업체구분		*/
				, exmn_bzenty_se_nm						/* 조사업체구분명		*/
				, sbmsn_stts_cd							/* 제출상태코드		*/
				, sbmsn_ymd								/* 제출일자			*/
				, getCodeNm('CM', '1001', reg_inst_cd)				AS reg_inst_nm		/* 등록기관명	*/
				, getCodeNm('CC', '1001', mfld_cd)					AS mfld_nm			/* 주력분야명	*/
				, getCodeNm('CC', '1004', sbmsn_stts_cd)			AS sbmsn_stts_nm	/* 제출상태명	*/
				, getSeqNo(page, cast(#{rows} AS NUMERIC), rownum) 	AS seq_no			/* 일련번호		*/
				, page												AS page				/* 페이지		*/
				, total_count										AS total_count		/* 검색건수		*/
		FROM	(
				SELECT
						  cirs_sn
						, reg_inst_cd
						, pbanc_ymd
						, opnbd_ymd
						, mfld_cd
						, cstrn_nm
						, podr_inst_nm
						, cstrn_amt
						, exmn_bzenty_se
						, exmn_bzenty_se_nm
						, sbmsn_stts_cd
						, sbmsn_ymd
						, CEIL((ROW_NUMBER() OVER (ORDER BY opnbd_ymd DESC, cstrn_nm))/ CAST(#{rows} AS NUMERIC) ) AS page
			         	, COUNT(*) OVER() AS total_count
				FROM	CC_CSMA_T
				WHERE	use_yn = 'Y'
				<if test="fromYmd != null and fromYmd != '' and toYmd != null and toYmd != ''">
					AND pbanc_ymd BETWEEN #{fromYmd} AND #{toYmd}
				</if>
				<if test="regInstCd != null and regInstCd != '' ">
					AND reg_inst_cd = #{regInstCd}
				</if>
				<if test="mfldCd != null and mfldCd != '' ">
					AND mfld_cd = #{mfldCd}
				</if>
				<if test="sbmsnSttsCd != null and sbmsnSttsCd != '' ">
					AND sbmsn_stts_cd = #{sbmsnSttsCd}
				</if>
				<if test="keyword != null and keyword != '' ">
					AND (	cstrn_nm 		LIKE '%' || #{keyword} || '%'
						OR	exmn_bzenty_nm 	LIKE '%' || #{keyword} || '%'
						)
				</if>
				<if test="exmnBzentyPicEmlAddr != null and exmnBzentyPicEmlAddr != ''">
					AND exmn_bzenty_pic_eml_addr = #{exmnBzentyPicEmlAddr}
					AND to_char(SYSDATE, 'yyyymmdd') BETWEEN sbmsn_bgng_ymd AND sbmsn_end_ymd
				</if>
				)
		WHERE 	page = CAST( #{page} AS NUMERIC)
	</select>


	<!-- 건설업등록기준사전조사 정보를  조회한다.  -->
	<select id="getCcCsmaInfo" parameterType="hashmap" resultMap="ccCsmaResultMap">
		SELECT
				  cirs_sn					/* 건설업등록기준일련번호	*/
				, reg_inst_cd				/* 등록기관코드			*/
				, pbanc_no					/* 공고번호				*/
				, pbanc_ymd					/* 공고일자				*/
				, opnbd_ymd					/* 개찰일자				*/
				, cstrn_nm					/* 공사명				*/
				, cstrn_amt					/* 공사금액(원)			*/
				, podr_inst_nm				/* 발주기관명			*/
				, bid_prtcpt_cndtn			/* 입찰참가조건			*/
				, bid_prtcpt_bzenty_cnt		/* 입찰참가업체수			*/
				, qfexmn_1rnk_bzenty_nm		/* 적격심사1순위업체명		*/
				, exmn_bzenty_se			/* 조사업체구분			*/
				, exmn_bzenty_se_nm			/* 조사업체구분명			*/
				, exmn_bzenty_nm			/* 조사업체명			*/
				, exmn_bzenty_rprsv_nm		/* 조사업체대표자명		*/
				, spco_se					/* 전문업체구분			*/
				, exmn_bzenty_addr			/* 조사업체주소			*/
				, exmn_bzenty_pic_nm		/* 조사업체담당자명		*/
				, exmn_bzenty_pic_telno		/* 조사업체담당자전화번호	*/
				, exmn_bzenty_pic_eml_addr	/* 조사업체담당자이메일주소	*/
				, exmn_bzenty_pic_pswd		/* 조사업체담당자비밀번호	*/
				, exmn_bzenty_crno			/* 조사업체법인등록번호		*/
				, mfld_cd					/* 주력분야코드			*/
				, pssn_lcns					/* 보유면허				*/
				, mmadvn_se					/* 상호시장진출구분		*/
				, task_tkcg_ao_nm			/* 업무담당주무관명		*/
				, cptl_tkcg_ao_nm			/* 자본금담당주무관명		*/
				, acse_cstrn_pic_nm			/* 재무과공사담당자명		*/
				, sbmsn_bgng_ymd			/* 제출시작일자			*/
				, sbmsn_end_ymd				/* 제출종료일자			*/
				, sbmsn_stts_cd				/* 제출상태코드			*/
				, sbmsn_ymd					/* 제출일자				*/
				, updt_ymd 					/* 갱신일자    			*/
				, updusr_id					/* 갱신자ID    		*/
				, updusr_ip					/* 갱신자IP    		*/
				, rmrk						/* 비고				*/
		FROM	CC_CSMA_T
		WHERE	use_yn = 'Y'
			AND rownum = 1
		<if test="cirsSn != null and cirsSn != '' ">
			AND cirs_sn = #{cirsSn}
		</if>
		<if test="exmnBzentyPicEmlAddr != null and exmnBzentyPicEmlAddr != '' ">
			AND exmn_bzenty_pic_eml_addr = #{exmnBzentyPicEmlAddr}
			AND to_char(SYSDATE, 'yyyymmdd') BETWEEN sbmsn_bgng_ymd AND sbmsn_end_ymd
		</if>
 	</select>



	<!-- 건설업등록기준사전조사 정보를  등록한다.  -->
	<insert id="insertCcCsma" parameterType="com.g3way.sicims.services.sicims300Cc.vo.CcCsmaVo" >
		<selectKey keyProperty="cirsSn"  resultType="java.math.BigDecimal" order="BEFORE" >
			SELECT  CC_CSMA_T_SQ.nextval FROM DUAL
		</selectKey>
		INSERT INTO CC_CSMA_T (
				  cirs_sn
				, reg_inst_cd
				, pbanc_no
				, pbanc_ymd
				, opnbd_ymd
				, cstrn_nm
				, cstrn_amt
				, podr_inst_nm
				, bid_prtcpt_cndtn
				, bid_prtcpt_bzenty_cnt
				, qfexmn_1rnk_bzenty_nm
				, exmn_bzenty_se
				, exmn_bzenty_se_nm
				, exmn_bzenty_nm
				, exmn_bzenty_rprsv_nm
				, spco_se
				, exmn_bzenty_addr
				, exmn_bzenty_pic_nm
				, exmn_bzenty_pic_telno
				, exmn_bzenty_pic_eml_addr
				, exmn_bzenty_pic_pswd
				, exmn_bzenty_crno
				, mfld_cd
				, pssn_lcns
				, mmadvn_se
				, task_tkcg_ao_nm
				, cptl_tkcg_ao_nm
				, acse_cstrn_pic_nm
				, sbmsn_bgng_ymd
				, sbmsn_end_ymd
				, sbmsn_stts_cd
				, sbmsn_ymd
				, updt_ymd
				, updusr_id
				, updusr_ip
				, rmrk
				)
		VALUES (
				  #{cirsSn				 ,jdbcType=DECIMAL}		/* 건설업등록기준일련번호	*/
				, #{regInstCd			 ,jdbcType=VARCHAR}		/* 등록기관코드			*/
				, #{pbancNo				 ,jdbcType=VARCHAR}		/* 공고번호				*/
				, #{pbancYmd			 ,jdbcType=VARCHAR}		/* 공고일자				*/
				, #{opnbdYmd			 ,jdbcType=VARCHAR}		/* 개찰일자				*/
				, #{cstrnNm				 ,jdbcType=VARCHAR}		/* 공사명				*/
				, #{cstrnAmt			 ,jdbcType=DECIMAL}		/* 공사금액(원)			*/
				, #{podrInstNm			 ,jdbcType=VARCHAR}		/* 발주기관명			*/
				, #{bidPrtcptCndtn		 ,jdbcType=VARCHAR}		/* 입찰참가조건			*/
				, #{bidPrtcptBzentyCnt	 ,jdbcType=DECIMAL}		/* 입찰참가업체수			*/
				, #{qfexmn1rnkBzentyNm	 ,jdbcType=VARCHAR}		/* 적격심사1순위업체명		*/
				, #{exmnBzentySe		 ,jdbcType=VARCHAR}		/* 조사업체구분			*/
				, #{exmnBzentySeNm		 ,jdbcType=VARCHAR}		/* 조사업체구분명			*/
				, #{exmnBzentyNm		 ,jdbcType=VARCHAR}		/* 조사업체명			*/
				, #{exmnBzentyRprsvNm	 ,jdbcType=VARCHAR}		/* 조사업체대표자명		*/
				, #{spcoSe				 ,jdbcType=VARCHAR}		/* 전문업체구분			*/
				, #{exmnBzentyAddr		 ,jdbcType=VARCHAR}		/* 조사업체주소			*/
				, #{exmnBzentyPicNm		 ,jdbcType=VARCHAR}		/* 조사업체담당자명		*/
				, #{exmnBzentyPicTelno	 ,jdbcType=VARCHAR}		/* 조사업체담당자전화번호	*/
				, #{exmnBzentyPicEmlAddr ,jdbcType=VARCHAR}		/* 조사업체담당자이메일주소	*/
				, #{exmnBzentyPicPswd	 ,jdbcType=VARCHAR}		/* 조사업체담당자비밀번호	*/
				, #{exmnBzentyCrno		 ,jdbcType=VARCHAR}		/* 조사업체법인등록번호		*/
				, #{mfldCd				 ,jdbcType=VARCHAR}		/* 주력분야코드			*/
				, #{pssnLcns			 ,jdbcType=VARCHAR}		/* 보유면허				*/
				, #{mmadvnSe			 ,jdbcType=VARCHAR}		/* 상호시장진출구분		*/
				, #{taskTkcgAoNm		 ,jdbcType=VARCHAR}		/* 업무담당주무관명		*/
				, #{cptlTkcgAoNm		 ,jdbcType=VARCHAR}		/* 자본금담당주무관명		*/
				, #{acseCstrnPicNm		 ,jdbcType=VARCHAR}		/* 재무과공사담당자명		*/
				, #{sbmsnBgngYmd		 ,jdbcType=VARCHAR}		/* 제출시작일자			*/
				, #{sbmsnEndYmd			 ,jdbcType=VARCHAR}		/* 제출종료일자			*/
				, '0002'										/* 제출상태코드 : 미제출	*/
				, null											/* 제출일자				*/
				, to_char(SYSDATE, 'yyyymmdd')					/* 갱신일자				*/
				, #{updusrId			 ,jdbcType=VARCHAR}		/* 갱신자ID    		*/
				, #{updusrIp			 ,jdbcType=VARCHAR}		/* 갱신자IP    		*/
				, #{rmrk				 ,jdbcType=VARCHAR}		/* 비고				*/
				)
	</insert>

 	<!-- 건설업등록기준사전조사 정보를  수정한다.  -->
	<update id="updateCcCsma" parameterType="com.g3way.sicims.services.sicims300Cc.vo.CcCsmaVo" >
		UPDATE 	CC_CSMA_T
		SET
				  reg_inst_cd				= #{regInstCd			 ,jdbcType=VARCHAR}		/* 등록기관코드			*/
				, pbanc_no					= #{pbancNo				 ,jdbcType=VARCHAR}		/* 공고번호				*/
				, pbanc_ymd					= #{pbancYmd			 ,jdbcType=VARCHAR}		/* 공고일자				*/
				, opnbd_ymd					= #{opnbdYmd			 ,jdbcType=VARCHAR}		/* 개찰일자				*/
				, cstrn_nm					= #{cstrnNm				 ,jdbcType=VARCHAR}		/* 공사명				*/
				, cstrn_amt					= #{cstrnAmt			 ,jdbcType=DECIMAL}		/* 공사금액(원)			*/
				, podr_inst_nm				= #{podrInstNm			 ,jdbcType=VARCHAR}		/* 발주기관명			*/
				, bid_prtcpt_cndtn			= #{bidPrtcptCndtn		 ,jdbcType=VARCHAR}		/* 입찰참가조건			*/
				, bid_prtcpt_bzenty_cnt		= #{bidPrtcptBzentyCnt	 ,jdbcType=DECIMAL}		/* 입찰참가업체수			*/
				, qfexmn_1rnk_bzenty_nm		= #{qfexmn1rnkBzentyNm	 ,jdbcType=VARCHAR}		/* 적격심사1순위업체명		*/
				, exmn_bzenty_se			= #{exmnBzentySe		 ,jdbcType=VARCHAR}		/* 조사업체구분			*/
				, exmn_bzenty_se_nm			= #{exmnBzentySeNm		 ,jdbcType=VARCHAR}		/* 조사업체구분명			*/
				, exmn_bzenty_nm			= #{exmnBzentyNm		 ,jdbcType=VARCHAR}		/* 조사업체명			*/
				, exmn_bzenty_rprsv_nm		= #{exmnBzentyRprsvNm	 ,jdbcType=VARCHAR}		/* 조사업체대표자명		*/
				, spco_se					= #{spcoSe				 ,jdbcType=VARCHAR}		/* 전문업체구분			*/
				, exmn_bzenty_addr			= #{exmnBzentyAddr		 ,jdbcType=VARCHAR}		/* 조사업체주소			*/
				, exmn_bzenty_pic_nm		= #{exmnBzentyPicNm		 ,jdbcType=VARCHAR}		/* 조사업체담당자명		*/
				, exmn_bzenty_pic_telno		= #{exmnBzentyPicTelno	 ,jdbcType=VARCHAR}		/* 조사업체담당자전화번호	*/
				, exmn_bzenty_pic_eml_addr	= #{exmnBzentyPicEmlAddr ,jdbcType=VARCHAR}		/* 조사업체담당자이메일주소	*/
				, exmn_bzenty_pic_pswd		= #{exmnBzentyPicPswd	 ,jdbcType=VARCHAR}		/* 조사업체담당자비밀번호	*/
				, exmn_bzenty_crno			= #{exmnBzentyCrno		 ,jdbcType=VARCHAR}		/* 조사업체법인등록번호		*/
				, mfld_cd					= #{mfldCd				 ,jdbcType=VARCHAR}		/* 주력분야코드			*/
				, pssn_lcns					= #{pssnLcns			 ,jdbcType=VARCHAR}		/* 보유면허				*/
				, mmadvn_se					= #{mmadvnSe			 ,jdbcType=VARCHAR}		/* 상호시장진출구분		*/
				, task_tkcg_ao_nm			= #{taskTkcgAoNm		 ,jdbcType=VARCHAR}		/* 업무담당주무관명		*/
				, cptl_tkcg_ao_nm			= #{cptlTkcgAoNm		 ,jdbcType=VARCHAR}		/* 자본금담당주무관명		*/
				, acse_cstrn_pic_nm			= #{acseCstrnPicNm		 ,jdbcType=VARCHAR}		/* 재무과공사담당자명		*/
				, sbmsn_bgng_ymd			= #{sbmsnBgngYmd		 ,jdbcType=VARCHAR}		/* 제출시작일자			*/
				, sbmsn_end_ymd				= #{sbmsnEndYmd			 ,jdbcType=VARCHAR}		/* 제출종료일자			*/
				, updt_ymd 					= to_char(SYSDATE, 'yyyymmdd')					/* 갱신일자				*/
				, updusr_ip					= #{updusrIp			 ,jdbcType=VARCHAR}		/* 갱신자IP    		*/
				, rmrk						= #{rmrk				 ,jdbcType=VARCHAR}		/* 비고				*/
		WHERE	cirs_sn = #{cirsSn}
	</update>


 	<!-- 건설업등록기준사전조사 제출상태 정보를  수정한다.  -->
	<update id="updateCcCsmaSbmsn" parameterType="hashmap" >
		UPDATE 	CC_CSMA_T csma
		SET
				<!--   sbmsn_stts_cd	= DECODE((SELECT MAX(exmn_data_sbmsn_ymd) FROM CC_CSEX_T cct WHERE cct.cirs_sn = csma.cirs_sn), null, '0002', '0001')
				, sbmsn_ymd		= (SELECT MAX(exmn_data_sbmsn_ymd) FROM CC_CSEX_T cct WHERE cct.cirs_sn = csma.cirs_sn) -->
				sbmsn_stts_cd	=  '0001'
				, sbmsn_ymd = to_char(SYSDATE, 'yyyymmdd')
				, updt_ymd 		= to_char(SYSDATE, 'yyyymmdd')			/* 갱신일자		*/
				, updusr_ip		= #{updusrIp,	jdbcType=VARCHAR}		/* 갱신자IP   	*/
				, rmrk			= '제출상태 정보 변경'
		WHERE	cirs_sn = #{cirsSn}
	</update>



 	<!-- 업체담당자비밀번호를 변경한다.  -->
	<update id="updateCcCsmaPswd" parameterType="com.g3way.sicims.services.sicims300Cc.vo.CcCsmaVo" >
		UPDATE 	CC_CSMA_T
		SET
				  exmn_bzenty_pic_pswd 	= #{exmnBzentyPicPswd,	jdbcType=VARCHAR}		/* 조사업체담당자비밀번호	*/
				, updt_ymd 				= to_char(SYSDATE, 'yyyymmdd')					/* 갱신일자		*/
				, updusr_ip				= #{updusrIp,			jdbcType=VARCHAR}		/* 갱신자IP   	*/
				, rmrk					= '비밀번호 초기화'
		WHERE	exmn_bzenty_pic_eml_addr = #{exmnBzentyPicEmlAddr}
	</update>


	<!-- 건설업등록기준사전조사 정보를 삭제한다.  -->
	<delete id="deleteCcCsma" parameterType="hashmap">
		DELETE 	FROM CC_CSMA_T
		WHERE	cirs_sn = #{cirsSn}
	</delete>



	<!--
	================================
	  1.2 민원관리-건설업등록기준사전조사결과 정보
	================================
	 -->
	<!-- 건설업등록기준사전조사결과 정보 -->
	<resultMap id="ccCsrsResultMap" type="com.g3way.sicims.services.sicims300Cc.vo.CcCsrsVo" >
		<result column="cirs_sn"				property="cirsSn"				jdbcType="DECIMAL"/>
		<result column="vst_ymd"				property="vstYmd"				jdbcType="VARCHAR"/>
		<result column="last_rslt"				property="lastRslt"				jdbcType="VARCHAR"/>
		<result column="ofc_stblt_yn"			property="ofcStbltYn"			jdbcType="VARCHAR"/>
		<result column="tcnblt_stblt_yn"		property="tcnbltStbltYn"		jdbcType="VARCHAR"/>
		<result column="cptl_stblt_yn"			property="cptlStbltYn"			jdbcType="VARCHAR"/>
		<result column="admdsp_vltn_cn"			property="admdspVltnCn"			jdbcType="VARCHAR"/>
		<result column="admdsp_lcns"			property="admdspLcns"			jdbcType="VARCHAR"/>
		<result column="admdsp_vltn"			property="admdspVltn"			jdbcType="VARCHAR"/>
		<result column="admdsp_inst_nm"			property="admdspInstNm"			jdbcType="VARCHAR"/>
		<result column="admdsp_rqst_ymd"		property="admdspRqstYmd"		jdbcType="VARCHAR"/>
		<result column="admdsp_cn"				property="admdspCn"				jdbcType="VARCHAR"/>
		<result column="admdsp_bgng_ymd"		property="admdspBgngYmd"		jdbcType="VARCHAR"/>
		<result column="admdsp_end_ymd"			property="admdspEndYmd"			jdbcType="VARCHAR"/>
		<result column="ctrt_excl"				property="ctrtExcl"				jdbcType="VARCHAR"/>
		<result column="ontc_ymd"				property="ontcYmd"				jdbcType="VARCHAR"/>
		<result column="ontc_atfl_id"			property="ontcAtflId"			jdbcType="DECIMAL"/>
		<result column="rslt_rpt_ymd"			property="rsltRptYmd"			jdbcType="VARCHAR"/>
		<result column="rslt_rpt_atfl_id"		property="rsltRptAtflId"		jdbcType="DECIMAL"/>
		<result column="acse_ntfctn_ymd"		property="acseNtfctnYmd"		jdbcType="VARCHAR"/>
		<result column="acse_ntfctn_atfl_id"	property="acseNtfctnAtflId"		jdbcType="DECIMAL"/>

		<result column="use_yn"					property="useYn"				jdbcType="VARCHAR"/>
		<result column="updt_ymd"				property="updtYmd"				jdbcType="VARCHAR"/>
		<result column="updusr_id"				property="updusrId"				jdbcType="VARCHAR"/>
		<result column="updusr_ip"				property="updusrIp"				jdbcType="VARCHAR"/>
		<result column="rmrk"					property="rmrk"					jdbcType="VARCHAR"/>

		<result column="ontc_atfl_nm"			property="ontcAtflNm"			jdbcType="VARCHAR"/>
		<result column="rslt_rpt_atfl_nm"		property="rsltRptAtflNm"		jdbcType="VARCHAR"/>
		<result column="acse_ntfctn_atfl_nm"	property="acseNtfctnAtflNm"		jdbcType="VARCHAR"/>
	</resultMap>

	<!-- 건설업등록기준사전조사결과 정보를  조회한다.  -->
	<select id="getCcCsrsInfo" parameterType="hashmap" resultMap="ccCsrsResultMap">
		SELECT
				  csrs.cirs_sn									/* 건설업등록기준일련번호*/
				, csrs.vst_ymd									/* 방문일자			*/
				, csrs.last_rslt								/* 최종결과			*/
				, csrs.ofc_stblt_yn								/* 사무실적합여부		*/
				, csrs.tcnblt_stblt_yn							/* 기술능력적합여부	*/
				, csrs.cptl_stblt_yn							/* 자본금적합여부		*/
				, csrs.admdsp_vltn_cn							/* 행정처분위반내용	*/
				, csrs.admdsp_lcns								/* 행정처분면허		*/
				, csrs.admdsp_vltn								/* 행정처분위반		*/
				, csrs.admdsp_inst_nm							/* 행정처분기관명		*/
				, csrs.admdsp_rqst_ymd							/* 행정처분의뢰일자	*/
				, csrs.admdsp_cn								/* 행정처분내용		*/
				, csrs.admdsp_bgng_ymd							/* 행정처분시작일자	*/
				, csrs.admdsp_end_ymd							/* 행정처분종료일자	*/
				, csrs.ctrt_excl								/* 계약제외			*/
				, csrs.ontc_ymd									/* 공문알림일자		*/
				, csrs.ontc_atfl_id								/* 공문알림첨부파일ID	*/
				, csrs.rslt_rpt_ymd								/* 결과보고일자		*/
				, csrs.rslt_rpt_atfl_id							/* 결과보고첨부파일ID	*/
				, csrs.acse_ntfctn_ymd							/* 재무과통보일자		*/
				, csrs.acse_ntfctn_atfl_id						/* 재무과통보첨부파일ID	*/
				, csrs.use_yn									/* 사용여부    		*/
				, csrs.updt_ymd									/* 갱신일자			*/
				, csrs.updusr_id								/* 갱신자ID		*/
				, csrs.updusr_ip								/* 갱신자IP		*/
				, csrs.rmrk										/* 비고			*/
				, cft1.file_orgnl_nm	AS ontc_atfl_nm			/* 조사자료첨부파일명	*/
				, cft2.file_orgnl_nm	AS rslt_rpt_atfl_nm		/* 조사자료첨부파일명	*/
				, cft3.file_orgnl_nm	AS acse_ntfctn_atfl_nm	/* 조사자료첨부파일명	*/
		FROM	CC_CSRS_T csrs
		LEFT	JOIN CM_FILE_T cft1 ON (cft1.file_id = csrs.ontc_atfl_id)
		LEFT	JOIN CM_FILE_T cft2 ON (cft2.file_id = csrs.rslt_rpt_atfl_id)
		LEFT	JOIN CM_FILE_T cft3 ON (cft3.file_id = csrs.acse_ntfctn_atfl_id)
		WHERE 	csrs.cirs_sn = #{cirsSn}
 	</select>


	<!-- 건설업등록기준사전조사결과 정보를  저장한다.  -->
	<update id="saveOrUpdateCcCsrs" parameterType="com.g3way.sicims.services.sicims300Cc.vo.CcCsrsVo" >
 		MERGE INTO CC_CSRS_T csrs
 			USING DUAL ON (csrs.cirs_sn = #{cirsSn})
 			WHEN MATCHED THEN
 				UPDATE SET
						  vst_ymd				= #{vstYmd			,jdbcType=VARCHAR}		/* 방문일자			*/
						, last_rslt				= #{lastRslt		,jdbcType=VARCHAR}		/* 최종결과			*/
						, ofc_stblt_yn			= #{ofcStbltYn		,jdbcType=VARCHAR}		/* 사무실적합여부		*/
						, tcnblt_stblt_yn		= #{tcnbltStbltYn	,jdbcType=VARCHAR}		/* 기술능력적합여부	*/
						, cptl_stblt_yn			= #{cptlStbltYn		,jdbcType=VARCHAR}		/* 자본금적합여부		*/
						, admdsp_vltn_cn		= #{admdspVltnCn	,jdbcType=VARCHAR}		/* 행정처분위반내용	*/
						, admdsp_lcns			= #{admdspLcns		,jdbcType=VARCHAR}		/* 행정처분면허		*/
						, admdsp_vltn			= #{admdspVltn		,jdbcType=VARCHAR}		/* 행정처분위반		*/
						, admdsp_inst_nm		= #{admdspInstNm	,jdbcType=VARCHAR}		/* 행정처분기관명		*/
						, admdsp_rqst_ymd		= #{admdspRqstYmd	,jdbcType=VARCHAR}		/* 행정처분의뢰일자	*/
						, admdsp_cn				= #{admdspCn		,jdbcType=VARCHAR}		/* 행정처분내용		*/
						, admdsp_bgng_ymd		= #{admdspBgngYmd	,jdbcType=VARCHAR}		/* 행정처분시작일자	*/
						, admdsp_end_ymd		= #{admdspEndYmd	,jdbcType=VARCHAR}		/* 행정처분종료일자	*/
						, ctrt_excl				= #{ctrtExcl		,jdbcType=VARCHAR}		/* 계약제외			*/
						, ontc_ymd				= #{ontcYmd			,jdbcType=VARCHAR}		/* 공문알림일자		*/
					<if test="ontcAtflId != null and ontcAtflId != '' ">
						, ontc_atfl_id			= #{ontcAtflId		,jdbcType=DECIMAL}		/* 공문알림첨부파일ID	*/
					</if>
						, rslt_rpt_ymd			= #{rsltRptYmd		,jdbcType=VARCHAR}		/* 결과보고일자		*/
					<if test="rsltRptAtflId != null and rsltRptAtflId != '' ">
						, rslt_rpt_atfl_id		= #{rsltRptAtflId	,jdbcType=DECIMAL}		/* 결과보고첨부파일ID	*/
					</if>
						, acse_ntfctn_ymd		= #{acseNtfctnYmd	,jdbcType=VARCHAR}		/* 재무과통보일자		*/
					<if test="acseNtfctnAtflId != null and acseNtfctnAtflId != '' ">
						, acse_ntfctn_atfl_id	= #{acseNtfctnAtflId,jdbcType=DECIMAL}		/* 재무과통보첨부파일ID*/
					</if>
						, updt_ymd				= TO_CHAR(SYSDATE,'YYYYMMDD')				/* 갱신일자     		*/
						, updusr_id				= #{updusrId		,jdbcType=VARCHAR}		/* 갱신자ID		*/
						, updusr_ip				= #{updusrIp		,jdbcType=VARCHAR}		/* 갱신자IP		*/
						, rmrk					= #{rmrk			,jdbcType=VARCHAR}		/* 비고			*/
 			WHEN NOT MATCHED THEN
				INSERT (
						  cirs_sn
						, vst_ymd
						, last_rslt
						, ofc_stblt_yn
						, tcnblt_stblt_yn
						, cptl_stblt_yn
						, admdsp_vltn_cn
						, admdsp_lcns
						, admdsp_vltn
						, admdsp_inst_nm
						, admdsp_rqst_ymd
						, admdsp_cn
						, admdsp_bgng_ymd
						, admdsp_end_ymd
						, ctrt_excl
						, ontc_ymd
						, ontc_atfl_id
						, rslt_rpt_ymd
						, rslt_rpt_atfl_id
						, acse_ntfctn_ymd
						, acse_ntfctn_atfl_id
						, updt_ymd
						, updusr_id
						, updusr_ip
						, rmrk
						)
				VALUES (
						  #{cirsSn			,jdbcType=DECIMAL}		/* 건설업등록기준일련번호*/
						, #{vstYmd			,jdbcType=VARCHAR}		/* 방문일자			*/
						, #{lastRslt		,jdbcType=VARCHAR}		/* 최종결과			*/
						, #{ofcStbltYn		,jdbcType=VARCHAR}		/* 사무실적합여부		*/
						, #{tcnbltStbltYn	,jdbcType=VARCHAR}		/* 기술능력적합여부	*/
						, #{cptlStbltYn		,jdbcType=VARCHAR}		/* 자본금적합여부		*/
						, #{admdspVltnCn	,jdbcType=VARCHAR}		/* 행정처분위반내용	*/
						, #{admdspLcns		,jdbcType=VARCHAR}		/* 행정처분면허		*/
						, #{admdspVltn		,jdbcType=VARCHAR}		/* 행정처분위반		*/
						, #{admdspInstNm	,jdbcType=VARCHAR}		/* 행정처분기관명		*/
						, #{admdspRqstYmd	,jdbcType=VARCHAR}		/* 행정처분의뢰일자	*/
						, #{admdspCn		,jdbcType=VARCHAR}		/* 행정처분내용		*/
						, #{admdspBgngYmd	,jdbcType=VARCHAR}		/* 행정처분시작일자	*/
						, #{admdspEndYmd	,jdbcType=VARCHAR}		/* 행정처분종료일자	*/
						, #{ctrtExcl		,jdbcType=VARCHAR}		/* 계약제외			*/
						, #{ontcYmd			,jdbcType=VARCHAR}		/* 공문알림일자		*/
						, #{ontcAtflId		,jdbcType=DECIMAL}		/* 공문알림첨부파일ID	*/
						, #{rsltRptYmd		,jdbcType=VARCHAR}		/* 결과보고일자		*/
						, #{rsltRptAtflId	,jdbcType=DECIMAL}		/* 결과보고첨부파일ID	*/
						, #{acseNtfctnYmd	,jdbcType=VARCHAR}		/* 재무과통보일자		*/
						, #{acseNtfctnAtflId,jdbcType=DECIMAL}		/* 재무과통보첨부파일ID*/
						, TO_CHAR(SYSDATE,'YYYYMMDD')				/* 갱신일자     	*/
						, #{updusrId		,jdbcType=VARCHAR}		/* 갱신자ID		*/
						, #{updusrIp		,jdbcType=VARCHAR}		/* 갱신자IP		*/
						, #{rmrk			,jdbcType=VARCHAR}		/* 비고			*/
						)
	</update>


	<!-- 건설업등록기준사전조사결과의 파일 정보를 삭제한다.  -->
	<update id="deleteCcCsrsFile" parameterType="hashmap">
		UPDATE 	CC_CSRS_T
		SET		  updt_ymd		= TO_CHAR(SYSDATE,'YYYYMMDD')			/* 갱신일자     	*/
				, updusr_id		= #{updusrId,	jdbcType=VARCHAR}		/* 갱신자ID   	*/
				, updusr_ip		= #{updusrIp,	jdbcType=VARCHAR}		/* 갱신자IP   	*/
			<if test="ontcAtflId != null and ontcAtflId != '' ">
				, ontc_atfl_id = null
			</if>
			<if test="rsltRptAtflId != null and rsltRptAtflId != '' ">
				, rslt_rpt_atfl_id = null
			</if>
			<if test="acseNtfctnAtflId != null and acseNtfctnAtflId != '' ">
				, acse_ntfctn_atfl_id = null
			</if>
		WHERE	cirs_sn = #{cirsSn}
	</update>


	<!--
	================================
	  1.3 민원관리-건설업등록기준사전자료제출
	================================
	 -->
	<!-- 건설업등록기준사전자료제출 정보 -->
	<resultMap id="ccCsexResultMap" type="com.g3way.sicims.services.sicims300Cc.vo.CcCsexVo" >
		<result column="cirs_sn"				property="cirsSn"				jdbcType="DECIMAL"/>
		<result column="exmn_data_sn"			property="exmnDataSn"			jdbcType="VARCHAR"/>
		<result column="exmn_data_sbmsn_ymd"	property="exmnDataSbmsnYmd"		jdbcType="VARCHAR"/>
		<result column="exmn_data_cn"			property="exmnDataCn"			jdbcType="VARCHAR"/>
		<result column="exmn_data_atfl_id"		property="exmnDataAtflId"		jdbcType="DECIMAL"/>
		<result column="exmn_data_atfl_nm"		property="exmnDataAtflNm"		jdbcType="VARCHAR"/>

		<result column="use_yn"					property="useYn"				jdbcType="VARCHAR"/>
		<result column="updt_ymd"				property="updtYmd"				jdbcType="VARCHAR"/>
		<result column="updusr_id"				property="updusrId"				jdbcType="VARCHAR"/>
		<result column="updusr_ip"				property="updusrIp"				jdbcType="VARCHAR"/>
		<result column="rmrk"					property="rmrk"					jdbcType="VARCHAR"/>
	</resultMap>


	<!--  건설업등록기준사전조사 제출자료 목록을 조회한다.  -->
	<select id="getCcCsexList" parameterType="hashmap" resultMap="ccCsexResultMap">
		SELECT
				  cct.cirs_sn								/* 건설업등록기준일련번호 */
				, cct.exmn_data_sn							/* 조사자료일련번호	*/
				, cct.exmn_data_sbmsn_ymd					/* 조사자료제출일자	*/
				, cct.exmn_data_cn							/* 조사자료내용		*/
				, cct.exmn_data_atfl_id						/* 조사자료첨부파일ID	*/
				, cct.rmrk									/* 비고			*/
				, cft.file_orgnl_nm AS exmn_data_atfl_nm	/* 조사자료첨부파일명	*/
		FROM	CC_CSEX_T cct
		LEFT	JOIN CM_FILE_T cft ON (cft.file_id = cct.exmn_data_atfl_id)
		WHERE 	cct.cirs_sn = #{cirsSn}
			AND cct.use_yn = 'Y'
	</select>


	<!-- 건설업등록기준사전조사 제출자료 정보를  조회한다.  -->
	<select id="getCcCsexInfo" parameterType="hashmap" resultMap="ccCsexResultMap">
		SELECT
				  cct.cirs_sn								/* 건설업등록기준일련번호 */
				, cct.exmn_data_sn							/* 조사자료일련번호	*/
				, cct.exmn_data_sbmsn_ymd					/* 조사자료제출일자	*/
				, cct.exmn_data_cn							/* 조사자료내용		*/
				, cct.exmn_data_atfl_id						/* 조사자료첨부파일ID	*/
				, cct.rmrk									/* 비고			*/
				, cft.file_orgnl_nm	AS exmn_data_atfl_nm	/* 조사자료첨부파일명	*/
		FROM	CC_CSEX_T cct
		LEFT	JOIN CM_FILE_T cft ON (cft.file_id = cct.exmn_data_atfl_id)
		WHERE 	cct.cirs_sn = #{cirsSn}
			AND cct.exmn_data_sn = #{exmnDataSn}
 	</select>

	<!-- 건설업등록기준사전조사자료 제출 정보를  등록한다.  -->
	<insert id="insertCcCsex" parameterType="com.g3way.sicims.services.sicims300Cc.vo.CcCsexVo" >
		<selectKey keyProperty="exmnDataSn"  resultType="string" order="BEFORE" >
			SELECT  LPAD(CAST(COALESCE(MAX(exmn_data_sn), '0') AS NUMERIC) + 1, 3, '0')
			FROM	CC_CSEX_T
			WHERE	cirs_sn = #{cirsSn}
		</selectKey>
		INSERT INTO CC_CSEX_T (
				  cirs_sn
				, exmn_data_sn
				, exmn_data_sbmsn_ymd
				, exmn_data_cn
				, exmn_data_atfl_id
				, updt_ymd
				, updusr_id
				, updusr_ip
				, rmrk
				)
		VALUES (
				  #{cirsSn				 ,jdbcType=DECIMAL}		/* 건설업등록기준일련번호*/
				, #{exmnDataSn			 ,jdbcType=VARCHAR}		/* 조사자료일련번호	*/
				, to_char(SYSDATE, 'yyyymmdd')					/* 조사자료제출일자	*/
				, #{exmnDataCn			 ,jdbcType=VARCHAR}		/* 조사자료내용		*/
				, #{exmnDataAtflId		 ,jdbcType=VARCHAR}		/* 조사자료첨부파일ID	*/
				, to_char(SYSDATE, 'yyyymmdd')					/* 갱신일자			*/
				, #{updusrId			 ,jdbcType=VARCHAR}		/* 갱신자ID    	*/
				, #{updusrIp			 ,jdbcType=VARCHAR}		/* 갱신자IP    	*/
				, #{rmrk				 ,jdbcType=VARCHAR}		/* 비고			*/
				)
	</insert>




	<!--
	================================
	  2. 민원관리-위반업체행정처분 정보
	================================
	 -->

	<resultMap id="ccVcadResultMap" type="com.g3way.sicims.services.sicims300Cc.vo.CcVcadVo" >
		<result column="admdsp_sn"			property="admdspSn"			jdbcType="DECIMAL" />
		<result column="reg_inst_cd"		property="regInstCd"		jdbcType="VARCHAR" />
		<result column="ntfctn_ymd"			property="ntfctnYmd"		jdbcType="VARCHAR" />
		<result column="ntfctn_inst_nm"		property="ntfctnInstNm"		jdbcType="VARCHAR" />
		<result column="rcpt_doc_no"		property="rcptDocNo"		jdbcType="VARCHAR" />
		<result column="bzenty_nm"			property="bzentyNm"			jdbcType="VARCHAR" />
		<result column="crno"				property="crno"				jdbcType="VARCHAR" />
		<result column="lctn"				property="lctn"				jdbcType="VARCHAR" />
		<result column="vltn_cn"			property="vltnCn"			jdbcType="VARCHAR" />
		<result column="vltn_spcn_se"		property="vltnSpcnSe"		jdbcType="VARCHAR" />
		<result column="vltn_artcl"			property="vltnArtcl"		jdbcType="VARCHAR" />
		<result column="cmptn_se"			property="cmptnSe"			jdbcType="VARCHAR" />
		<result column="doc_no"				property="docNo"			jdbcType="VARCHAR" />
		<result column="pic_nm"				property="picNm"			jdbcType="VARCHAR" />
		<result column="prgrs_stts_cd"		property="prgrsSttsCd"		jdbcType="VARCHAR" />
		<result column="dsps_cn"			property="dspsCn"			jdbcType="VARCHAR" />
		<result column="dsps_bss_artcl"		property="dspsBssArtcl"		jdbcType="VARCHAR" />
		<result column="dsps_trmn_ymd"		property="dspsTrmnYmd"		jdbcType="VARCHAR" />
		<result column="dtl_cn"				property="dtlCn"			jdbcType="VARCHAR" />
		<result column="prcs_plan"			property="prcsPlan"			jdbcType="VARCHAR" />

		<result column="use_yn"				property="useYn"			jdbcType="VARCHAR"/>
		<result column="updt_ymd" 			property="updtYmd" 			jdbcType="CHAR"/>
		<result column="updusr_id" 			property="updusrId" 		jdbcType="VARCHAR"/>
		<result column="updusr_ip" 			property="updusrIp" 		jdbcType="VARCHAR"/>
		<result column="rmrk"				property="rmrk"				jdbcType="VARCHAR" />

		<result column="reg_inst_nm"		property="regInstNm"		jdbcType="VARCHAR" />
		<result column="vltn_spcn_se_nm"	property="vltnSpcnSeNm"		jdbcType="VARCHAR" />
		<result column="cmptn_se_nm"		property="cmptnSeNm"		jdbcType="VARCHAR" />
		<result column="prgrs_stts_nm"		property="prgrsSttsNm"		jdbcType="VARCHAR" />

		<result column="seq_no"				property="seqNo"			jdbcType="DECIMAL" />
		<result column="page"				property="page"				jdbcType="DECIMAL" />
		<result column="total_count"		property="totalCount"		jdbcType="DECIMAL" />
	</resultMap>



	<!-- 페이지 단위로 위반업체행정처분 목록을 조회한다.  -->
	<select id="selectCcVcadList" parameterType="hashmap" resultMap="ccVcadResultMap">
		SELECT
				  admdsp_sn																/* 행정처분일련번호*/
				, reg_inst_cd															/* 등록기관코드	*/
				, crno																	/* 법인등록번호	*/
				, bzenty_nm																/* 업체명		*/
				, ntfctn_inst_nm														/* 통보기관명	*/
				, ntfctn_ymd															/* 통보일자		*/
				, getCodeNm('CM', '1001', reg_inst_cd)				AS reg_inst_nm		/* 등록기관명	*/
				, getCodeNm('CC', '0001', vltn_spcn_se)				AS vltn_spcn_se_nm	/* 위반혐의구분명	*/
				, getSeqNo(page, cast(#{rows} AS NUMERIC), rownum) 	AS seq_no			/* 일련번호		*/
				, page												AS page				/* 페이지		*/
				, total_count										AS total_count		/* 검색건수		*/
		FROM	(
				SELECT
						  admdsp_sn
						, reg_inst_cd
						, crno
						, bzenty_nm
						, ntfctn_inst_nm
						, ntfctn_ymd
						, vltn_spcn_se
						, CEIL((ROW_NUMBER() OVER (ORDER BY ntfctn_ymd DESC, bzenty_nm))/ CAST(#{rows} AS NUMERIC) ) AS page
			         	, COUNT(*) OVER() AS total_count
				FROM	CC_VCAD_T
				WHERE	use_yn = 'Y'
				<if test="regInstCd != null and regInstCd != '' ">
					AND reg_inst_cd = #{regInstCd}
				</if>
				<if test="vltnSpcnSe != null and vltnSpcnSe != '' ">
					AND vltn_spcn_se = #{vltnSpcnSe}
				</if>
				<if test="keyword != null and keyword != '' ">
					AND (	bzenty_nm 	LIKE '%' || #{keyword} || '%'
						OR	crno 		LIKE '%' || #{keyword} || '%'
						)
				</if>
				)
		WHERE 	page = CAST( #{page} AS NUMERIC)
	</select>


	<!-- 위반업체행정처분 정보를  조회한다.  -->
	<select id="getCcVcadInfo" parameterType="hashmap" resultMap="ccVcadResultMap">
		SELECT
				  admdsp_sn				/* 행정처분일련번호	*/
				, reg_inst_cd			/* 등록기관코드		*/
				, ntfctn_ymd			/* 통보일자			*/
				, ntfctn_inst_nm		/* 통보기관명		*/
				, rcpt_doc_no			/* 접수문서번호		*/
				, bzenty_nm				/* 업체명			*/
				, crno					/* 법인등록번호		*/
				, lctn					/* 소재지			*/
				, vltn_cn				/* 위반내용			*/
				, vltn_spcn_se			/* 위반혐의구분		*/
				, vltn_artcl			/* 위반조항			*/
				, cmptn_se				/* 완료구분			*/
				, doc_no				/* 문서번호			*/
				, pic_nm				/* 담당자명			*/
				, prgrs_stts_cd			/* 진행상태코드		*/
				, dsps_cn				/* 처분내용			*/
				, dsps_bss_artcl		/* 처분근거조항		*/
				, dsps_trmn_ymd			/* 처분종결일자		*/
				, dtl_cn				/* 상세내용			*/
				, prcs_plan				/* 처리계획			*/
				, updt_ymd				/* 갱신일자			*/
				, updusr_id				/* 갱신자ID		*/
				, updusr_ip				/* 갱신자IP		*/
				, rmrk					/* 비고			*/
		FROM	CC_VCAD_T
		WHERE   admdsp_sn 	= #{admdspSn}
 	</select>



	<!-- 위반업체행정처분 정보를  등록한다.  -->
	<insert id="insertCcVcad" parameterType="com.g3way.sicims.services.sicims300Cc.vo.CcVcadVo" >
		<selectKey keyProperty="admdspSn"  resultType="java.math.BigDecimal" order="BEFORE" >
			SELECT  CC_VCAD_T_SQ.nextval FROM DUAL
		</selectKey>
		INSERT INTO CC_VCAD_T (
				  admdsp_sn
				, reg_inst_cd
				, ntfctn_ymd
				, ntfctn_inst_nm
				, rcpt_doc_no
				, bzenty_nm
				, crno
				, lctn
				, vltn_cn
				, vltn_spcn_se
				, vltn_artcl
				, cmptn_se
				, doc_no
				, pic_nm
				, prgrs_stts_cd
				, dsps_cn
				, dsps_bss_artcl
				, dsps_trmn_ymd
				, dtl_cn
				, prcs_plan
				, updt_ymd
				, updusr_id
				, updusr_ip
				, rmrk
				)
		VALUES (
				  #{admdspSn	,jdbcType=DECIMAL}		/* 행정처분일련번호	*/
				, #{regInstCd	,jdbcType=VARCHAR}		/* 등록기관			*/
				, #{ntfctnYmd	,jdbcType=VARCHAR}		/* 통보일자			*/
				, #{ntfctnInstNm,jdbcType=VARCHAR}		/* 통보기관명		*/
				, #{rcptDocNo	,jdbcType=VARCHAR}		/* 접수문서번호		*/
				, #{bzentyNm	,jdbcType=VARCHAR}		/* 업체명			*/
				, #{crno		,jdbcType=VARCHAR}		/* 법인등록번호		*/
				, #{lctn		,jdbcType=VARCHAR}		/* 소재지			*/
				, #{vltnCn		,jdbcType=VARCHAR}		/* 위반내용			*/
				, #{vltnSpcnSe	,jdbcType=VARCHAR}		/* 위반혐의구분		*/
				, #{vltnArtcl	,jdbcType=VARCHAR}		/* 위반조항			*/
				, #{cmptnSe		,jdbcType=VARCHAR}		/* 완료구분			*/
				, #{docNo		,jdbcType=VARCHAR}		/* 문서번호			*/
				, #{picNm		,jdbcType=VARCHAR}		/* 담당자명			*/
				, #{prgrsSttsCd	,jdbcType=VARCHAR}		/* 진행상태코드		*/
				, #{dspsCn		,jdbcType=VARCHAR}		/* 처분내용			*/
				, #{dspsBssArtcl,jdbcType=VARCHAR}		/* 처분근거조항		*/
				, #{dspsTrmnYmd	,jdbcType=VARCHAR}		/* 처분종결일자		*/
				, #{dtlCn		,jdbcType=VARCHAR}		/* 상세내용			*/
				, #{prcsPlan	,jdbcType=VARCHAR}		/* 처리계획			*/
				, to_char(SYSDATE, 'yyyymmdd')			/* 갱신일자			*/
				, #{updusrId	,jdbcType=VARCHAR}		/* 갱신자ID		*/
				, #{updusrIp	,jdbcType=VARCHAR}		/* 갱신자IP		*/
				, #{rmrk		,jdbcType=VARCHAR}		/* 비고			*/
				)
	</insert>

 	<!-- 위반업체행정처분 정보를  수정한다.  -->
	<update id="updateCcVcad" parameterType="com.g3way.sicims.services.sicims300Cc.vo.CcVcadVo" >
		UPDATE 	CC_VCAD_T
		SET
				  reg_inst_cd		= #{regInstCd	,jdbcType=VARCHAR}	/* 등록기관		*/
				, ntfctn_ymd		= #{ntfctnYmd	,jdbcType=VARCHAR}	/* 통보일자		*/
				, ntfctn_inst_nm	= #{ntfctnInstNm,jdbcType=VARCHAR}	/* 통보기관명	*/
				, rcpt_doc_no		= #{rcptDocNo	,jdbcType=VARCHAR}	/* 접수문서번호	*/
				, bzenty_nm			= #{bzentyNm	,jdbcType=VARCHAR}	/* 업체명		*/
				, crno				= #{crno		,jdbcType=VARCHAR}	/* 법인등록번호	*/
				, lctn				= #{lctn		,jdbcType=VARCHAR}	/* 소재지		*/
				, vltn_cn			= #{vltnCn		,jdbcType=VARCHAR}	/* 위반내용		*/
				, vltn_spcn_se		= #{vltnSpcnSe	,jdbcType=VARCHAR}	/* 위반혐의구분	*/
				, vltn_artcl		= #{vltnArtcl	,jdbcType=VARCHAR}	/* 위반조항		*/
				, cmptn_se			= #{cmptnSe		,jdbcType=VARCHAR}	/* 완료구분		*/
				, doc_no			= #{docNo		,jdbcType=VARCHAR}	/* 문서번호		*/
				, pic_nm			= #{picNm		,jdbcType=VARCHAR}	/* 담당자명		*/
				, prgrs_stts_cd		= #{prgrsSttsCd	,jdbcType=VARCHAR}	/* 진행상태코드	*/
				, dsps_cn			= #{dspsCn		,jdbcType=VARCHAR}	/* 처분내용		*/
				, dsps_bss_artcl	= #{dspsBssArtcl,jdbcType=VARCHAR}	/* 처분근거조항	*/
				, dsps_trmn_ymd		= #{dspsTrmnYmd	,jdbcType=VARCHAR}	/* 처분종결일자	*/
				, dtl_cn			= #{dtlCn		,jdbcType=VARCHAR}	/* 상세내용		*/
				, prcs_plan			= #{prcsPlan	,jdbcType=VARCHAR}	/* 처리계획		*/
				, updt_ymd			= to_char(SYSDATE, 'yyyymmdd')		/* 갱신일자		*/
				, updusr_id			= #{updusrId	,jdbcType=VARCHAR}	/* 갱신자ID	*/
				, updusr_ip			= #{updusrIp	,jdbcType=VARCHAR}	/* 갱신자IP	*/
				, rmrk				= #{rmrk		,jdbcType=VARCHAR}	/* 비고		*/
		WHERE	admdsp_sn = #{admdspSn}
	</update>


	<!-- 위반업체행정처분 정보를 삭제한다.  -->
	<delete id="deleteCcVcad" parameterType="hashmap">
		DELETE 	FROM CC_VCAD_T
		WHERE	admdsp_sn = #{admdspSn}
	</delete>


	<!--
	================================
	  3. 민원관리-불법하도급신고
	================================
	 -->
	<!-- 불법하도급신고 정보 -->
	<resultMap id="ccIsrdResultMap" type="com.g3way.sicims.services.sicims300Cc.vo.CcIsrdVo" >
		<result column="rcpt_no"						property="rcptNo"					jdbcType="VARCHAR"/>
		<result column="reg_inst_cd"					property="regInstCd"				jdbcType="VARCHAR"/>
		<result column="rcpt_ymd"						property="rcptYmd"					jdbcType="VARCHAR"/>
		<result column="dcl_nm"							property="dclNm"					jdbcType="VARCHAR"/>
		<result column="dcl_brdt"						property="dclBrdt"					jdbcType="VARCHAR"/>
		<result column="dcl_addr"						property="dclAddr"					jdbcType="VARCHAR"/>
		<result column="dcl_telno"						property="dclTelno"					jdbcType="VARCHAR"/>
		<result column="dcl_eml_addr"					property="dclEmlAddr"				jdbcType="VARCHAR"/>
		<result column="gnctrt_bzenty_kiscon_mng_no"	property="gnctrtBzentyKisconMngNo"	jdbcType="VARCHAR"/>
		<result column="gnctrt_bzenty_nm"				property="gnctrtBzentyNm"			jdbcType="VARCHAR"/>
		<result column="gnctrt_bzenty_pic_telno"		property="gnctrtBzentyPicTelno"		jdbcType="VARCHAR"/>
		<result column="gisbe_kiscon_mng_no"			property="gisbeKisconMngNo"			jdbcType="VARCHAR"/>
		<result column="gisbe_nm"						property="gisbeNm"					jdbcType="VARCHAR"/>
		<result column="gisbe_telno"					property="gisbeTelno"				jdbcType="VARCHAR"/>
		<result column="risbe_kiscon_mng_no"			property="risbeKisconMngNo"			jdbcType="VARCHAR"/>
		<result column="risbe_nm"						property="risbeNm"					jdbcType="VARCHAR"/>
		<result column="risbe_telno"					property="risbeTelno"				jdbcType="VARCHAR"/>
		<result column="cstrn_nm"						property="cstrnNm"					jdbcType="VARCHAR"/>
		<result column="podr_inst_nm"					property="podrInstNm"				jdbcType="VARCHAR"/>
		<result column="cstrn_spot_addr"				property="cstrnSpotAddr"			jdbcType="VARCHAR"/>
		<result column="dclr_cn"						property="dclrCn"					jdbcType="VARCHAR"/>
		<result column="evdnc_dcmnt"					property="evdncDcmnt"				jdbcType="VARCHAR"/>
		<result column="dclr_file_id"					property="dclrFileId"				jdbcType="DECIMAL"/>
		<result column="dclr_file_nm"					property="dclrFileNm"				jdbcType="VARCHAR"/>
		<result column="dclr_rmrk"						property="dclrRmrk"					jdbcType="VARCHAR"/>

		<result column="use_yn"							property="useYn"					jdbcType="VARCHAR"/>
		<result column="updt_ymd"						property="updtYmd"					jdbcType="VARCHAR"/>
		<result column="updusr_id"						property="updusrId"					jdbcType="VARCHAR"/>
		<result column="updusr_ip"						property="updusrIp"					jdbcType="VARCHAR"/>

		<result column="reg_inst_nm"					property="regInstNm"				jdbcType="VARCHAR" />

		<result column="seq_no"							property="seqNo"					jdbcType="DECIMAL" />
		<result column="page"							property="page"						jdbcType="DECIMAL" />
		<result column="total_count"					property="totalCount"				jdbcType="DECIMAL" />
	</resultMap>

	<!-- 불법하도급신고결과 정보 -->
	<resultMap id="ccIsrrResultMap" type="com.g3way.sicims.services.sicims300Cc.vo.CcIsrrVo" >
		<result column="rcpt_no"			property="rcptNo"			jdbcType="VARCHAR"/>
		<result column="ilgsct_cn"			property="ilgsctCn"			jdbcType="VARCHAR"/>
		<result column="ilgsct_trdr"		property="ilgsctTrdr"		jdbcType="VARCHAR"/>
		<result column="ilgsct_stg"			property="ilgsctStg"		jdbcType="VARCHAR"/>
		<result column="vltn_bzenty_nm"		property="vltnBzentyNm"		jdbcType="VARCHAR"/>
		<result column="podr_inst_nm"		property="podrInstNm"		jdbcType="VARCHAR"/>
		<result column="dsps_inst_nm"		property="dspsInstNm"		jdbcType="VARCHAR"/>
		<result column="dclr_cn"			property="dclrCn"			jdbcType="VARCHAR"/>
		<result column="prcs_rslt"			property="prcsRslt"			jdbcType="VARCHAR"/>
		<result column="rslt_rmrk"			property="rsltRmrk"			jdbcType="VARCHAR"/>
		<result column="rslt_file_id"		property="rsltFileId"		jdbcType="DECIMAL"/>
		<result column="rslt_file_nm"		property="rsltFileNm"		jdbcType="VARCHAR"/>

		<result column="use_yn"				property="useYn"			jdbcType="VARCHAR"/>
		<result column="updt_ymd"			property="updtYmd"			jdbcType="VARCHAR"/>
		<result column="updusr_id"			property="updusrId"			jdbcType="VARCHAR"/>
		<result column="updusr_ip"			property="updusrIp"			jdbcType="VARCHAR"/>
	</resultMap>



	<!-- 페이지 단위로 불법하도급신고 목록을 조회한다.  -->
	<select id="selectCcIsrdList" parameterType="hashmap" resultMap="ccIsrdResultMap">
		SELECT
				  rcpt_no				/* 접수번호			*/
				, reg_inst_cd			/* 등록기관코드		*/
				, dcl_nm				/* 신고자명			*/
				, dcl_telno				/* 신고자전화번호		*/
				, rcpt_ymd				/* 접수일자			*/
				, gnctrt_bzenty_nm		/* 원도급업체명		*/
				, gisbe_nm				/* 불법하도급지급업체명 	*/
				, risbe_nm				/* 불법하도급수령업체명 	*/
				, getCodeNm('CM', '1001', reg_inst_cd)				AS reg_inst_nm		/* 등록기관명	*/
				, getSeqNo(page, cast(#{rows} AS NUMERIC), rownum) 	AS seq_no			/* 일련번호		*/
				, page												AS page				/* 페이지		*/
				, total_count										AS total_count		/* 검색건수		*/
		FROM	(
				SELECT
						  rcpt_no
						, reg_inst_cd
						, dcl_nm
						, dcl_telno
						, rcpt_ymd
						, gnctrt_bzenty_nm
						, gisbe_nm
						, risbe_nm
						, CEIL((ROW_NUMBER() OVER (ORDER BY rcpt_ymd DESC, dcl_nm))/ CAST(#{rows} AS NUMERIC) ) AS page
			         	, COUNT(*) OVER() AS total_count
				FROM	CC_ISRD_T
				WHERE	use_yn = 'Y'
					AND rcpt_ymd BETWEEN #{fromYmd} AND #{toYmd}
				<if test="regInstCd != null and regInstCd != '' ">
					AND reg_inst_cd = #{regInstCd}
				</if>
				<if test="keyword != null and keyword != '' ">
					AND dcl_nm 	LIKE '%' || #{keyword} || '%'
				</if>
				)
		WHERE 	page = CAST( #{page} AS NUMERIC)
	</select>

	<!-- KISCON 관리번호로 불법하도급신고 목록을 조회한다.  -->
	<select id="getCcIsrdList" parameterType="hashmap" resultMap="ccIsrdResultMap">
		SELECT
				  rcpt_no				/* 접수번호			*/
				, reg_inst_cd			/* 등록기관코드		*/
				, dcl_nm				/* 신고자명			*/
				, dcl_telno				/* 신고자전화번호		*/
				, rcpt_ymd				/* 접수일자			*/
				, gnctrt_bzenty_nm		/* 원도급업체명		*/
				, gisbe_nm				/* 불법하도급지급업체명 	*/
				, risbe_nm				/* 불법하도급수령업체명 	*/
				, getCodeNm('CM', '1001', reg_inst_cd)				AS reg_inst_nm		/* 등록기관명	*/
		FROM	CC_ISRD_T
		WHERE	use_yn = 'Y'
			AND (  gnctrt_bzenty_kiscon_mng_no = #{cncoMngNo}
				OR gisbe_kiscon_mng_no = #{cncoMngNo}
				OR risbe_kiscon_mng_no = #{cncoMngNo}
				)
		ORDER BY rcpt_ymd DESC, dcl_nm
	</select>


	<!-- 불법하도급신고 정보를  조회한다.  -->
	<select id="getCcIsrdInfo" parameterType="hashmap" resultMap="ccIsrdResultMap">
		SELECT
				  isrd.rcpt_no						/* 접수번호					*/
				, isrd.reg_inst_cd					/* 등록기관코드				*/
				, isrd.rcpt_ymd						/* 접수일자					*/
				, isrd.dcl_nm						/* 신고자명					*/
				, isrd.dcl_brdt						/* 신고자생년월일				*/
				, isrd.dcl_addr						/* 신고자주소				*/
				, isrd.dcl_telno					/* 신고자전화번호				*/
				, isrd.dcl_eml_addr					/* 신고자이메일주소			*/
				, isrd.gnctrt_bzenty_kiscon_mng_no	/* 원도급업체KISCON관리번호		*/
				, isrd.gnctrt_bzenty_nm				/* 원도급업체명				*/
				, isrd.gnctrt_bzenty_pic_telno		/* 원도급업체담당자전화번호		*/
				, isrd.gisbe_kiscon_mng_no			/* 불법하도급지급업체KISCON관리번호*/
				, isrd.gisbe_nm						/* 불법하도급지급업체명			*/
				, isrd.gisbe_telno					/* 불법하도급지급업체전화번호		*/
				, isrd.risbe_kiscon_mng_no			/* 불법하도급수령업체KISCON관리번호*/
				, isrd.risbe_nm						/* 불법하도급수령업체명			*/
				, isrd.risbe_telno					/* 불법하도급수령업체전화번호		*/
				, isrd.cstrn_nm						/* 공사명					*/
				, isrd.podr_inst_nm					/* 발주기관명				*/
				, isrd.cstrn_spot_addr				/* 공사현장 주소				*/
				, isrd.dclr_cn						/* 신고내용					*/
				, isrd.evdnc_dcmnt					/* 증거서류					*/
				, isrd.dclr_file_id					/* 신고파일ID				*/
				, isrd.dclr_rmrk					/* 신고비고					*/
				, isrd.updt_ymd 					/* 갱신일자    				*/
				, isrd.updusr_id					/* 갱신자ID    			*/
				, isrd.updusr_ip					/* 갱신자IP    			*/
				, cft.file_orgnl_nm						AS dclr_file_nm		/* 신고파일명	*/
				, getCodeNm('CM', '1001', reg_inst_cd)	AS reg_inst_nm		/* 등록기관명	*/
		FROM	CC_ISRD_T isrd
		LEFT	JOIN CM_FILE_T cft ON (cft.file_id = isrd.dclr_file_id)
		WHERE   rcpt_no = #{rcptNo}
 	</select>



	<!-- 불법하도급신고 정보를  등록한다.  -->
	<insert id="insertCcIsrd" parameterType="com.g3way.sicims.services.sicims300Cc.vo.CcIsrdVo" >
		<selectKey keyProperty="rcptNo"  resultType="string" order="BEFORE" >
			SELECT 	TO_CHAR(SYSDATE, 'yyyy') || '-' ||
					LPAD(CAST(COALESCE(MAX(SUBSTR(rcpt_no, 6)), '0') AS NUMERIC) + 1, 5, '0')
			FROM    CC_ISRD_T
			WHERE	rcpt_no LIKE TO_CHAR(sysdate, 'yyyy') || '%'
		</selectKey>
		INSERT INTO CC_ISRD_T (
				  rcpt_no
				, reg_inst_cd
				, rcpt_ymd
				, dcl_nm
				, dcl_brdt
				, dcl_addr
				, dcl_telno
				, dcl_eml_addr
				, gnctrt_bzenty_kiscon_mng_no
				, gnctrt_bzenty_nm
				, gnctrt_bzenty_pic_telno
				, gisbe_kiscon_mng_no
				, gisbe_nm
				, gisbe_telno
				, risbe_kiscon_mng_no
				, risbe_nm
				, risbe_telno
				, cstrn_nm
				, podr_inst_nm
				, cstrn_spot_addr
				, dclr_cn
				, evdnc_dcmnt
				, dclr_file_id
				, dclr_rmrk
				, updt_ymd
				, updusr_id
				, updusr_ip
				)
		VALUES (
				  #{rcptNo					,jdbcType=VARCHAR}	/* 접수번호					*/
				, #{regInstCd				,jdbcType=VARCHAR}	/* 등록기관코드				*/
				, #{rcptYmd					,jdbcType=VARCHAR}	/* 접수일자					*/
				, #{dclNm					,jdbcType=VARCHAR}	/* 신고자명					*/
				, #{dclBrdt					,jdbcType=VARCHAR}	/* 신고자생년월일				*/
				, #{dclAddr					,jdbcType=VARCHAR}	/* 신고자주소				*/
				, #{dclTelno				,jdbcType=VARCHAR}	/* 신고자전화번호				*/
				, #{dclEmlAddr				,jdbcType=VARCHAR}	/* 신고자이메일주소			*/
				, #{gnctrtBzentyKisconMngNo	,jdbcType=VARCHAR}	/* 원도급업체KISCON관리번호		*/
				, #{gnctrtBzentyNm			,jdbcType=VARCHAR}	/* 원도급업체명				*/
				, #{gnctrtBzentyPicTelno	,jdbcType=VARCHAR}	/* 원도급업체담당자전화번호		*/
				, #{gisbeKisconMngNo		,jdbcType=VARCHAR}	/* 불법하도급지급업체KISCON관리번호*/
				, #{gisbeNm					,jdbcType=VARCHAR}	/* 불법하도급지급업체명			*/
				, #{gisbeTelno				,jdbcType=VARCHAR}	/* 불법하도급지급업체전화번호		*/
				, #{risbeKisconMngNo		,jdbcType=VARCHAR}	/* 불법하도급수령업체KISCON관리번호*/
				, #{risbeNm					,jdbcType=VARCHAR}	/* 불법하도급수령업체명			*/
				, #{risbeTelno				,jdbcType=VARCHAR}	/* 불법하도급수령업체전화번호		*/
				, #{cstrnNm					,jdbcType=VARCHAR}	/* 공사명					*/
				, #{podrInstNm				,jdbcType=VARCHAR}	/* 발주기관명				*/
				, #{cstrnSpotAddr			,jdbcType=VARCHAR}	/* 공사현장 주소				*/
				, #{dclrCn					,jdbcType=VARCHAR}	/* 신고내용					*/
				, #{evdncDcmnt				,jdbcType=VARCHAR}	/* 증거서류					*/
				, #{dclrFileId				,jdbcType=VARCHAR}	/* 신고파일ID				*/
				, #{dclrRmrk				,jdbcType=VARCHAR}	/* 신고비고					*/
				, TO_CHAR(SYSDATE,'YYYYMMDD')					/* 갱신일자     				*/
				, #{updusrId				,jdbcType=VARCHAR}	/* 갱신자ID   				*/
				, #{updusrIp				,jdbcType=VARCHAR}	/* 갱신자IP   				*/
				)
	</insert>

 	<!-- 불법하도급신고 정보를  수정한다.  -->
	<update id="updateCcIsrd" parameterType="com.g3way.sicims.services.sicims300Cc.vo.CcIsrdVo" >
		UPDATE 	CC_ISRD_T
		SET
				  reg_inst_cd					= #{regInstCd				,jdbcType=VARCHAR}	/* 등록기관코드				*/
				, rcpt_ymd						= #{rcptYmd					,jdbcType=VARCHAR}	/* 접수일자					*/
				, dcl_nm						= #{dclNm					,jdbcType=VARCHAR}	/* 신고자명					*/
				, dcl_brdt						= #{dclBrdt					,jdbcType=VARCHAR}	/* 신고자생년월일				*/
				, dcl_addr						= #{dclAddr					,jdbcType=VARCHAR}	/* 신고자주소				*/
				, dcl_telno						= #{dclTelno				,jdbcType=VARCHAR}	/* 신고자전화번호				*/
				, dcl_eml_addr					= #{dclEmlAddr				,jdbcType=VARCHAR}	/* 신고자이메일주소			*/
				, gnctrt_bzenty_kiscon_mng_no	= #{gnctrtBzentyKisconMngNo,jdbcType=VARCHAR}	/* 원도급업체KISCON관리번호		*/
				, gnctrt_bzenty_nm				= #{gnctrtBzentyNm			,jdbcType=VARCHAR}	/* 원도급업체명				*/
				, gnctrt_bzenty_pic_telno		= #{gnctrtBzentyPicTelno	,jdbcType=VARCHAR}	/* 원도급업체담당자전화번호		*/
				, gisbe_kiscon_mng_no			= #{gisbeKisconMngNo		,jdbcType=VARCHAR}	/* 불법하도급지급업체KISCON관리번호*/
				, gisbe_nm						= #{gisbeNm					,jdbcType=VARCHAR}	/* 불법하도급지급업체명			*/
				, gisbe_telno					= #{gisbeTelno				,jdbcType=VARCHAR}	/* 불법하도급지급업체전화번호		*/
				, risbe_kiscon_mng_no			= #{risbeKisconMngNo		,jdbcType=VARCHAR}	/* 불법하도급수령업체KISCON관리번호*/
				, risbe_nm						= #{risbeNm					,jdbcType=VARCHAR}	/* 불법하도급수령업체명			*/
				, risbe_telno					= #{risbeTelno				,jdbcType=VARCHAR}	/* 불법하도급수령업체전화번호		*/
				, cstrn_nm						= #{cstrnNm					,jdbcType=VARCHAR}	/* 공사명					*/
				, podr_inst_nm					= #{podrInstNm				,jdbcType=VARCHAR}	/* 발주기관명				*/
				, cstrn_spot_addr				= #{cstrnSpotAddr			,jdbcType=VARCHAR}	/* 공사현장 주소				*/
				, dclr_cn						= #{dclrCn					,jdbcType=VARCHAR}	/* 신고내용					*/
				, evdnc_dcmnt					= #{evdncDcmnt				,jdbcType=VARCHAR}	/* 증거서류					*/
				, dclr_file_id					= #{dclrFileId				,jdbcType=VARCHAR}	/* 신고파일ID				*/
				, dclr_rmrk						= #{dclrRmrk				,jdbcType=VARCHAR}	/* 신고비고					*/
				, updt_ymd 						= TO_CHAR(SYSDATE,'YYYYMMDD')					/* 갱신일자     				*/
				, updusr_id						= #{updusrId				,jdbcType=VARCHAR}	/* 갱신자ID   				*/
				, updusr_ip						= #{updusrIp				,jdbcType=VARCHAR}	/* 갱신자IP   				*/
		WHERE	rcpt_no = #{rcptNo}
	</update>


	<!-- 불법하도급신고 정보를 삭제한다.  -->
	<delete id="deleteCcIsrd" parameterType="hashmap">
		DELETE 	FROM CC_ISRD_T
		WHERE	rcpt_no = #{rcptNo}
	</delete>


	<!-- 불법하도급신고의 파일 정보를 삭제한다.  -->
	<update id="deleteCcIsrdFile" parameterType="hashmap">
		UPDATE 	CC_ISRD_T
		SET		  dclr_file_id 	= null
				, updt_ymd		= TO_CHAR(SYSDATE,'YYYYMMDD')			/* 갱신일자     	*/
				, updusr_id		= #{updusrId,	jdbcType=VARCHAR}		/* 갱신자ID   	*/
				, updusr_ip		= #{updusrIp,	jdbcType=VARCHAR}		/* 갱신자IP   	*/
		WHERE	rcpt_no = #{rcptNo}
	</update>


	<!-- 불법하도급신고결과 정보를  조회한다.  -->
	<select id="getCcIsrrInfo" parameterType="hashmap" resultMap="ccIsrrResultMap">
		SELECT
				  isrr.rcpt_no				/* 접수번호			*/
				, isrr.ilgsct_cn			/* 불법 하도급내용		*/
				, isrr.ilgsct_trdr			/* 불법 하도급거래자	*/
				, isrr.ilgsct_stg			/* 불법 하도급단계		*/
				, isrr.vltn_bzenty_nm		/* 위반업체명		*/
				, isrr.podr_inst_nm			/* 발주기관명		*/
				, isrr.dsps_inst_nm			/* 처분기관명		*/
				, isrr.dclr_cn				/* 신고내용			*/
				, isrr.prcs_rslt			/* 처리결과			*/
				, isrr.rslt_rmrk			/* 결과비고			*/
				, isrr.rslt_file_id			/* 결과파일ID		*/
				, isrr.updt_ymd 			/* 갱신일자    		*/
				, isrr.updusr_id			/* 갱신자ID    	*/
				, isrr.updusr_ip			/* 갱신자IP    	*/
				, cft.file_orgnl_nm	AS rslt_file_nm
		FROM	CC_ISRR_T isrr
		LEFT	JOIN CM_FILE_T cft ON (cft.file_id = isrr.rslt_file_id)
		WHERE   rcpt_no	= #{rcptNo}
 	</select>


	<!-- 불법하도급신고결과 정보를  저장한다.  -->
	<insert id="saveOrUpdateCcIsrr" parameterType="com.g3way.sicims.services.sicims300Cc.vo.CcIsrrVo" >
 		MERGE INTO CC_ISRR_T isrr
 			USING DUAL ON (isrr.rcpt_no = #{rcptNo})
 			WHEN MATCHED THEN
 				UPDATE SET
						  ilgsct_cn      = #{ilgsctCn		,jdbcType=VARCHAR}		/* 불법 하도급내용	*/
						, ilgsct_trdr    = #{ilgsctTrdr		,jdbcType=VARCHAR}		/* 불법 하도급거래자	*/
						, ilgsct_stg     = #{ilgsctStg		,jdbcType=VARCHAR}		/* 불법 하도급단계	*/
						, vltn_bzenty_nm = #{vltnBzentyNm	,jdbcType=VARCHAR}		/* 위반업체명		*/
						, podr_inst_nm   = #{podrInstNm		,jdbcType=VARCHAR}		/* 발주기관명		*/
						, dsps_inst_nm   = #{dspsInstNm		,jdbcType=VARCHAR}		/* 처분기관명		*/
						, dclr_cn        = #{dclrCn			,jdbcType=VARCHAR}		/* 신고내용			*/
						, prcs_rslt      = #{prcsRslt		,jdbcType=VARCHAR}		/* 처리결과			*/
						, rslt_rmrk      = #{rsltRmrk		,jdbcType=VARCHAR}		/* 결과비고			*/
						, rslt_file_id   = #{rsltFileId		,jdbcType=VARCHAR}		/* 결과파일ID		*/
						, updt_ymd       = TO_CHAR(SYSDATE,'YYYYMMDD')				/* 갱신일자     	*/
						, updusr_id      = #{updusrId		,jdbcType=VARCHAR}		/* 갱신자ID		*/
						, updusr_ip      = #{updusrIp		,jdbcType=VARCHAR}		/* 갱신자IP		*/
 			WHEN NOT MATCHED THEN
				INSERT (
						  rcpt_no
						, ilgsct_cn
						, ilgsct_trdr
						, ilgsct_stg
						, vltn_bzenty_nm
						, podr_inst_nm
						, dsps_inst_nm
						, dclr_cn
						, prcs_rslt
						, rslt_rmrk
						, rslt_file_id
						, updt_ymd
						, updusr_id
						, updusr_ip
						)
				VALUES (
						  #{rcptNo			,jdbcType=VARCHAR}		/* 접수번호			*/
						, #{ilgsctCn		,jdbcType=VARCHAR}		/* 불법 하도급내용	*/
						, #{ilgsctTrdr		,jdbcType=VARCHAR}		/* 불법 하도급거래자	*/
						, #{ilgsctStg		,jdbcType=VARCHAR}		/* 불법 하도급단계	*/
						, #{vltnBzentyNm	,jdbcType=VARCHAR}		/* 위반업체명		*/
						, #{podrInstNm		,jdbcType=VARCHAR}		/* 발주기관명		*/
						, #{dspsInstNm		,jdbcType=VARCHAR}		/* 처분기관명		*/
						, #{dclrCn			,jdbcType=VARCHAR}		/* 신고내용			*/
						, #{prcsRslt		,jdbcType=VARCHAR}		/* 처리결과			*/
						, #{rsltRmrk		,jdbcType=VARCHAR}		/* 결과비고			*/
						, #{rsltFileId		,jdbcType=VARCHAR}		/* 결과파일ID		*/
						, TO_CHAR(SYSDATE,'YYYYMMDD')				/* 갱신일자     	*/
						, #{updusrId		,jdbcType=VARCHAR}		/* 갱신자ID		*/
						, #{updusrIp		,jdbcType=VARCHAR}		/* 갱신자IP		*/
						)
	</insert>


	<!-- 불법하도급신고결과 정보를 삭제한다.  -->
	<delete id="deleteCcIsrr" parameterType="hashmap">
		DELETE 	FROM CC_ISRR_T
		WHERE	rcpt_no = #{rcptNo}
	</delete>


	<!-- 불법하도급신고결과 파일 정보를 삭제한다.  -->
	<update id="deleteCcIsrrFile" parameterType="hashmap">
		UPDATE 	CC_ISRR_T
		SET		  rslt_file_id 	= null
				, updt_ymd		= TO_CHAR(SYSDATE,'YYYYMMDD')			/* 갱신일자     	*/
				, updusr_id		= #{updusrId,	jdbcType=VARCHAR}		/* 갱신자ID   	*/
				, updusr_ip		= #{updusrIp,	jdbcType=VARCHAR}		/* 갱신자IP   	*/
		WHERE	rcpt_no = #{rcptNo}
	</update>
	
	<!-- 메일정보 조회한다.  --> 
	<resultMap id="mailSendResultMap" type="com.g3way.sicims.services.sicims300Cc.vo.CcMailVo" >
		<result column="cirs_sn"			property="cirsSn"			jdbcType="DECIMAL" />
		<result column="cstrn_nm"		property="cstrnNm"		jdbcType="VARCHAR" />
		<result column="exmn_bzenty_pic_nm"	property="exmnBzentyPicNm"		jdbcType="VARCHAR" />
		<result column="file_id"		property="fileId"		jdbcType="DECIMAL" />
		<result column="file_orgnl_nm"		property="fileOrgnlNm"		jdbcType="VARCHAR" />
		<result column="updt_ymd"				property="updtYmd"			jdbcType="VARCHAR" />
		<result column="eml_addr"				property="emlAddr"			jdbcType="VARCHAR" />
		<result column="exmn_bzenty_pic_telno"				property="exmnBzentyPicTelno"			jdbcType="VARCHAR" />
	</resultMap>
	
	<select id="getMainInfo" parameterType="hashmap" resultMap="mailSendResultMap">
			SELECT 
			  cct.cirs_sn 
			  ,cct.cstrn_nm 
			  , cct.exmn_bzenty_pic_nm 
			  , cct.exmn_bzenty_pic_telno
			  , cft.file_id 
			  , cft.file_orgnl_nm 
			  , cft.updt_ymd 
			  , cut.eml_addr
		  FROM CC_CSMA_T cct 
		  JOIN CC_CSEX_T cct2 ON (cct.CIRS_SN = cct2.CIRS_SN)
		  JOIN CM_USER_T cut on(cut.USER_NM = cct.TASK_TKCG_AO_NM)
		  JOIN CM_FILE_T cft  ON (cct2.EXMN_DATA_ATFL_ID = cft.FILE_ID)
		  WHERE cct.cirs_sn = #{cirsSn}
		  AND cft.FILE_ID  = #{fileId}
 	</select>

</mapper>